---
import Breadcrumbs from '@/components/Breadcrumbs.astro'
import PageHead from '@/components/PageHead.astro'
import Layout from '@/layouts/Layout.astro'

type CTFEntry = {
  name: string
  url: string
  team?: string
  placement: string
  description?: string
  month: number
  year: number
}

const MONTHS = [
  'January',
  'February',
  'March',
  'April',
  'May',
  'June',
  'July',
  'August',
  'September',
  'October',
  'November',
  'December',
]

const entries: CTFEntry[] = [
  {
    name: 'scriptCTF 2025',
    url: 'https://ctftime.org/event/2792',
    description: 'won Hex-Rays t-shirt (drama abt rule breakers)',
    placement: '3rd (1st HS)',
    team: 'CBF',
    month: 8,
    year: 2025,
  },

  {
    name: 'idekCTF 2025',
    url: 'https://ctftime.org/event/2746',
    description: 'cosmic squid 2nd again :(',
    placement: '2nd',
    team: 'Cosmic Squid',
    month: 8,
    year: 2025,
  },
  {
    name: 'DeadSec CTF 2025',
    url: 'https://ctftime.org/event/2631',
    description: 'quite hard ctf lmao (i get carried)',
    placement: '2nd',
    team: 'Cosmic Squid',
    month: 7,
    year: 2025,
  },
  {
    name: 'World Wide CTF 2025',
    url: 'https://ctftime.org/event/2753',
    description: 'get carrried by tien yay',
    placement: '22th',
    team: 'BCA',
    month: 7,
    year: 2025,
  },
  {
    name: 'DownUnderCTF 2025',
    url: 'https://ctftime.org/event/2669',
    description: 'spl nice place, i cheese hard chall (forengolf)',
    placement: '8th',
    team: 'SPL',
    month: 7,
    year: 2025,
  },
  {
    name: 'Shakti CTF 2025',
    url: 'https://ctftime.org/event/2803',
    description: 'women orz (solved some vm rev)',
    placement: '12th',
    team: 'BCA',
    month: 7,
    year: 2025,
  },

  {
    name: 'BDSec CTF 2025',
    url: 'https://ctftime.org/event/2784',
    description: 'so we won a shirt... but never got it',
    placement: '37th',
    team: 'BCA',
    month: 7,
    year: 2025,
  },

  {
    name: 'L3akCTF 2025',
    url: 'https://ctftime.org/event/2629',
    description: 'first time playing with CBF orz',
    placement: '44th',
    team: 'CBF',
    month: 7,
    year: 2025,
  },

  {
    name: 'cubeCTF 2025',
    url: 'https://ctftime.org/event/2820',
    description: 'this was quite fun solved some cool stuff',
    placement: '16th',
    team: 'BCA',
    month: 7,
    year: 2025,
  },

  {
    name: 'Google Capture The Flag 2025',
    url: 'https://ctftime.org/event/2718',
    description: 'im useless sorry guys (got carried)',
    placement: '3rd',
    team: '[:]',
    month: 6,
    year: 2025,
  },

  {
    name: 'smileyCTF 2025',
    url: 'https://ctftime.org/event/2591',
    description: 'blooded some rev then gave up (smiley orz)',
    placement: '79th',
    team: 'BCA',
    month: 6,
    year: 2025,
  },

  {
    name: 'TJCTF 2025',
    url: 'https://ctftime.org/event/2809',
    description: 'played with high schoolers from SPL',
    placement: '24th',
    team: 'SPL',
    month: 6,
    year: 2025,
  },

  {
    name: 'NahamCon CTF 2025',
    url: 'https://ctftime.org/event/2782',
    description: 'idk, solved some pretty cool rev i think',
    placement: '87th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'BYUCTF 2026',
    url: 'https://ctftime.org/event/2715',
    description: 'beat cbf + carried tien (dudcom groomed me)',
    placement: '17th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'San Diego CTF 2025',
    url: 'https://ctftime.org/event/2786',
    description: 'molly the goat, t10',
    placement: '9th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'Incognito 6.0',
    url: 'https://ctftime.org/event/2761',
    description: 'random lockin on small ctf',
    placement: '6th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'UMD 2025',
    url: 'https://ctftime.org/event/2563',
    description: 'i always confused this with UMass',
    placement: '72th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'UMD 2025',
    url: 'https://ctftime.org/event/2563',
    description: 'i always confused this with UMass',
    placement: '72th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'UMassCTF 2025',
    url: 'https://ctftime.org/event/2653',
    description: 'started using ida, more rev',
    placement: '37th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'TexSAW 2025',
    url: 'https://ctftime.org/event/2736',
    description: 'first podium placement, nice solved + GS join',
    placement: '3rd',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'PlaidCTF 2025',
    url: 'https://ctftime.org/event/2508',
    description: 'got fried cuz plaid orz, solved >0 challs tho',
    placement: '19th',
    team: 'BCA',
    month: 4,
    year: 2025,
  },

  {
    name: 'JerseyCTF V',
    url: 'https://ctftime.org/event/2667',
    description: 'pretty cool jersey yay, t20',
    placement: '19th',
    team: 'BCA',
    month: 3,
    year: 2025,
  },
  {
    name: 'TAMUctf 2025',
    url: 'https://ctftime.org/event/2681',
    description: 'i dont remember tbh',
    placement: '46th',
    team: 'BCA',
    month: 3,
    year: 2025,
  },
  {
    name: 'WolvCTF 2025',
    url: 'https://ctftime.org/event/2579',
    description: 'some fun osint and i think i cheesed chall for first time.',
    placement: '57th',
    team: 'BCA',
    month: 3,
    year: 2025,
  },
  {
    name: 'UTCTF 2025',
    url: 'https://ctftime.org/event/2641',
    description: 'on a trip playing on bus/hotel. first started maining rev',
    placement: '151th',
    team: 'BCA',
    month: 3,
    year: 2025,
  },
  {
    name: 'PicoCTF 2025',
    url: 'https://play.picoctf.org/events/74/scoreboards#4878',
    description: 'im still very new to ctf but solved some challs',
    placement: '29th (hs)',
    team: 'BCA',
    month: 3,
    year: 2025,
  },
  {
    name: 'PwnMe CTF Quals 2025',
    url: 'https://ctftime.org/event/2658',
    description: 'gave up early (common theme)',
    placement: '219th',
    team: 'BCA',
    month: 2,
    year: 2025,
  },
  {
    name: 'Garden State CTF',
    url: 'https://www.cyber.nj.gov/Home/Components/News/News/1598/186',
    description: 'my first ever ctf (thanks @tien for recruiting me)',
    placement: '2nd',
    month: 2,
    team: 'BCA',
    year: 2025,
  },
]

// Sort newest first
const sorted = [...entries].sort((a, b) => b.year - a.year || b.month - a.month)

// Group by month-year for monthly markers on the timeline
type Group = { year: number; month: number; items: CTFEntry[] }

const groupsMap = new Map<string, Group>()
for (const e of sorted) {
  const key = `${e.year}-${String(e.month).padStart(2, '0')}`
  if (!groupsMap.has(key))
    groupsMap.set(key, { year: e.year, month: e.month, items: [] })
  groupsMap.get(key)!.items.push(e)
}
const groups = Array.from(groupsMap.values()).sort(
  (a, b) => b.year - a.year || b.month - a.month,
)

// Calculate statistics
const totalCTFs = entries.length
const uniqueMonthsSet = new Set(entries.map((e) => `${e.year}-${e.month}`))
const totalMonths = uniqueMonthsSet.size
---

<Layout class="max-w-3xl">
  <PageHead
    slot="head"
    title="CTF History"
    description="Timeline of CTF competitions and results"
  />
  <Breadcrumbs items={[{ label: 'History', icon: 'lucide:calendar' }]} />

  <section aria-labelledby="ctf-history-title" class="font-mono">
    <h1 id="ctf-history-title" class="mt-5 text-3xl font-bold">CTF History</h1>
    <p class="text-muted-foreground mt-2">
      Competition results over time, newest first.
    </p>

    <!-- Statistics -->
    <div class="bg-secondary/30 mt-4 rounded-lg border p-4">
      <div class="flex flex-wrap gap-6 text-sm">
        <div>
          <span class="text-muted-foreground">Total CTFs:</span>
          <span class="ml-1 font-semibold">{totalCTFs}</span>
        </div>
        <div>
          <span class="text-muted-foreground">Months Active:</span>
          <span class="ml-1 font-semibold">{totalMonths}</span>
        </div>
      </div>
    </div>

    <!-- Disclaimer and Teams -->
    <div
      class="mt-4 rounded-lg border border-yellow-200 bg-yellow-50 p-4 dark:border-yellow-800 dark:bg-yellow-950/20"
    >
      <h2
        class="mb-2 text-sm font-semibold text-yellow-800 dark:text-yellow-200"
      >
        üìù Note
      </h2>
      <div class="space-y-2 text-xs text-yellow-700 dark:text-yellow-300">
        <p>
          <strong>Sorting:</strong> CTFs are sorted by month/year, but not necessarily within each month.
        </p>
        <p>
          <strong>Teams:</strong>
          <a
            href="https://ctftime.org/team/283028"
            target="_blank"
            rel="noopener noreferrer"
            class="font-mono hover:underline">BCA</a
          >,
          <a
            href="https://ctftime.org/team/222966"
            target="_blank"
            rel="noopener noreferrer"
            class="font-mono hover:underline">SPL</a
          >,
          <a
            href="https://ctftime.org/team/372043"
            target="_blank"
            rel="noopener noreferrer"
            class="font-mono hover:underline">CBF</a
          >,
          <a
            href="https://ctftime.org/team/396585"
            target="_blank"
            rel="noopener noreferrer"
            class="font-mono hover:underline">Cosmic Squid</a
          >,
          <a
            href="https://ctftime.org/team/375355"
            target="_blank"
            rel="noopener noreferrer"
            class="font-mono hover:underline"
            >[:]
          </a>
        </p>
      </div>
    </div>

    <div class="relative mt-8">
      <div class="bg-border absolute top-0 bottom-0 left-4 w-px"></div>

      <div class="space-y-10">
        {
          groups.map((group) => (
            <div>
              <div class="relative pl-10">
                <div class="bg-primary ring-background absolute top-2 left-4 h-3 w-3 rounded-full ring-2" />
                <p class="text-muted-foreground text-xs tracking-wider uppercase">
                  {MONTHS[group.month - 1]} {group.year}
                </p>
              </div>

              <ul class="mt-4 space-y-3">
                {group.items.map((e) => (
                  <li class="relative pl-10">
                    <div class="bg-accent ring-background absolute top-2 left-4 h-2 w-2 rounded-full ring-2" />
                    <div class="flex flex-wrap items-baseline gap-x-3 gap-y-1">
                      <a
                        href={e.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="text-primary font-medium hover:underline"
                      >
                        {e.name}
                      </a>

                      <span class="text-muted-foreground text-sm font-medium">
                        {e.placement}
                      </span>

                      {e.team && (
                        <span class="bg-secondary text-secondary-foreground rounded px-1.5 py-0.5 text-xs font-medium">
                          {e.team}
                        </span>
                      )}

                      {e.description && (
                        <span class="text-muted-foreground flex-shrink-0 text-sm italic">
                          ‚Äî {e.description}
                        </span>
                      )}
                    </div>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>

      <!-- Empty state message if no entries -->
      {
        groups.length === 0 && (
          <div class="py-12 text-center">
            <p class="text-muted-foreground">
              No CTF entries yet. Add some to the entries array!
            </p>
          </div>
        )
      }
    </div>
  </section>
</Layout>
